# HEARTBEAT.md - 分級心跳機制

## 核心邏輯

讀 `handoff.md`（輕量快照），不讀 MEMORY.md。需要細節時才用 memory_search。

心跳計數器 `heartbeat_count` 決定檢查深度：
- **輕量級**（count % 7 = 1,2,3）：<2k tokens
- **標準級**（count % 7 = 4,5,6）：<5k tokens  
- **完整級**（count % 7 = 0）：<17k tokens

## 輕量級心跳（每小時）

```
✓ 讀 handoff.md（狀態快照）
✓ 檢查進行中的任務（active_tasks）
✓ 檢查 P0 警報（critical_alerts）
✗ 不讀 MEMORY.md
✗ 不掃描所有日誌
```

**回覆：** HEARTBEAT_OK 或簡短警報

## 標準級心跳（每 6 小時）

```
✓ 輕量級的所有檢查
✓ 記憶統計（Golden/Silver/Bronze 數量）
✓ 增量更新（最近 3 天的變化）
✓ 子代理狀態（只檢查有沒有新消息）
✗ 不做完整系統檢查
```

**回覆：** 簡短狀態報告

## 完整級心跳（每 24 小時）

```
✓ 標準級的所有檢查
✓ 全系統檢查（cron 任務、記憶衰減、磁盤使用）
✓ 記憶清理（淘汰過期的 Bronze/Silver）
✓ 子代理完整歷史檢查
```

**回覆：** 詳細系統報告

## 快取規則

- **Golden 記憶**：快取 1 小時（不會衰減，很少變）
- **系統配置**：快取 1 小時
- **子代理狀態**：快取 30 分鐘

## 狀態汇报

- 發現問題 → 立即上報
- 系統正常 → HEARTBEAT_OK 或簡短確認
- 完整檢查 → 詳細報告
