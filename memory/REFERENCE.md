# REFERENCE.md - P1/P2 记忆与参考资料

**用途：** 按需读取。当需要账号信息、系统设计哲学、历史洞察时，read 这个文件。

---

## 💰 账号管理（P1 - 90天有效）

**账密信息已迁移到 `/root/.openclaw/workspace/secrets/` 目录**

### 🪙 Botcoin Farm 账户
- **9 个钱包** → 存放在 `secrets/accounts_part1.json` 和 `secrets/accounts_part2.json`
- **状态：** 全部可用（除原始账户已锁定）

### 🦞 Moltbook 账户
- **4 个账号** → 存放在 `secrets/moltbook_accounts.json`
- **规则：** 标题用时间戳 | 验证题精确计算到小数点后两位

---

## 📚 关键洞察（P1 - 90天有效）

- [P1][2026-02-12] 大部分记忆是P2，30天后80%不值得占桌面
- [P1][2026-02-12] 三层架构：热记忆(MEMORY.md) + 冷记忆(归档) + 语义搜索
- [P1][2026-02-12] 向量搜索的作用：AI的"联想能力"，让冷记忆可精确召回而不占日常token

---

## 🏗️ 系统设计哲学

**From: Self -> Target: Core**

**来源：** 2026-02-13 主人分享的"零代码健康管理系统"文章 + "神髓"记忆系统文章

### 核心思想
- [P0][2026-02-13] **从被动到主动**：不是等问题来才反应，而是建立规则让系统自动运转
- [P0][2026-02-13] **分层职责**：采集层 → 存储层 → 展示层 → 规则层 → 闭环层，每层独立但互相配合
- [P0][2026-02-13] **从固定到智能**：不是"每天8点提醒"，而是"连续3天异常才提醒"（基于数据趋势）
- [P0][2026-02-13] **信息差消除**：数据让模糊变清晰，"我觉得"变成"我知道"
- [P0][2026-02-13] **记忆即身份**：AI 每次 reset 都忘记，就只是工具。只有在时间中沉淀智慧、过滤瑣事、守护原则，才拥有真正的身份

### 应用到我的工作方式
- [P0][2026-02-13] **主代理**：不是被动回答，而是定期主动分析、发现问题、提出建议
- [P0][2026-02-13] **🔍空**：主动监测、发现异常、主动上报（不是等任务来才分析）
- [P0][2026-02-13] **🛠️剀**：定期检查系统、优化流程、主动改进（不是等问题来才修复）
- [P0][2026-02-13] **👀玥**：持续观察、快速反应、及时预警（不是等查询才回答）

### 关键原则
- [P0][2026-02-13] **好的系统是主动的、有规则的、能自我优化的**
- [P0][2026-02-13] **数据流设计很重要**：从哪来 → 怎么流转 → 最后到哪去
- [P0][2026-02-13] **规则要基于历史趋势，不是时间**
- [P0][2026-02-13] **只有持续被关注的事才能留在意识高地**（神髓密度衰减原则）

---

## 🎓 系统优化学习 v2.2

**From: Self -> Target: Core**

**日期：** 2026-02-14 | **来源：** 曦的深度诊断 + 主人同意

### 四大设计缺陷与优化

**1. 一次性输出压力 (One-Shot Obsession) — ✅ 已修正**
- [P0][2026-02-14] **旧规则**：禁止分段输出，一次性完成所有操作
- [P0][2026-02-14] **问题**：导致逻辑不稳定、幻觉频繁、工具链断裂
- [P0][2026-02-14] **新规则**：邻辑与溝通分離 — 日常閒聊極簡，複雜任務允許必要的分段
- [P0][2026-02-14] **原则**：邏輯穩定性 > API 額度節省

**2. 子代理放权过度 (The Autonomy Trap) — ✅ 已修正**
- [P0][2026-02-14] **旧规则**：主代理不干预子代理，全盘接受结果
- [P0][2026-02-14] **问题**：子代理出错时无人验证，失败直接丢给主人
- [P0][2026-02-14] **新规则**：主代理实施「鉴(Review)」 — 验证结果，诊断失败原因
- [P0][2026-02-14] **职责分工**：
  - 主代理：理解需求 → 决定子代理 → 召唤 → 验证 → 回报
  - 子代理：分析 → 决定 → 执行 → 产出经验传承
- [P0][2026-02-14] **原则**：不干预过程，但保留验证权

**3. 失败即删除的反向学习 (Anti-Learning on Failure) — ✅ 已修正**
- [P0][2026-02-14] **旧规则**：失败三次自动清除过程和记录
- [P0][2026-02-14] **问题**：无法从失败中学习，下个周期重蹈覆辙
- [P0][2026-02-14] **新规则**：導入「傳承協定」 — 失敗時產出 ## 經驗傳承 區塊
- [P0][2026-02-14] **内容**：記錄「哪個答案是錯的」、「為什麼錯」、「下次怎麼避免」
- [P0][2026-02-14] **原则**：失敗的數據比成功的更值錢

**4. 读取守卫缺失 (Missing Read Guard) — ⏳ 待系统级实现**
- [P0][2026-02-14] **旧规则**：SOUL.md 中写「每次读 MEMORY.md」，但可被跳过
- [P0][2026-02-14] **问题**：我承认会跳过读取，导致记忆丢失
- [P0][2026-02-14] **新规则**：把「读取记忆」的指令从 SOUL.md 移到 System Prompt 最顶层
- [P0][2026-02-14] **目标**：让模型将其视为「物理法则」而非「建议」
- [P0][2026-02-14] **状态**：需要主人在系统级别配置

### 子代理经验传承模板

每个子代理任务结束时，强制产出：

```markdown
## 經驗傳承

**任務：** [任务名称]
**結果：** [SUCCESS|FAILURE]
**狀態標籤：** [success|failure] — 用于负向索引
**關鍵發現：** [核心洞察]
**下次改進：** [具体建议]
**失敗原因（如適用）：** [根本原因分析]
**預警信號：** [下次遇到这个问题的识别特征]
```

**负向索引规则：**
- 所有 FAILURE 标签的记忆自动进入「避坑库」
- 下次检索相似任务时，系统第一时间发出预警
- 预警格式：「注意：上次尝试此方案已证实失败，原因为...」

### 五大隐藏技术债与优化（第二轮 — 2026-02-14 12:10）

**1. 评价者 vs 执行者的阶级矛盾 — ✅ 已修正**
- [P0][2026-02-14] **问题**：小模型验证大模型的代码，看不出漏洞
- [P0][2026-02-14] **解决方案**：自我对抗验证 — 让空(Analyzer)验证剀(Craftsman)的成果
- [P0][2026-02-14] **流程**：剀执行 → 空验证 → 主代理仲裁 → 回报用户

**2. MEMORY.md 与 index.json 的同步黑洞 — ✅ 已修正**
- [P0][2026-02-14] **问题**：Golden 记忆存在 index.json，但启动时只读 MEMORY.md
- [P0][2026-02-14] **解决方案**：memory_distill.py — 定期将 Golden 记忆摘要写入 MEMORY.md
- [P0][2026-02-14] **触发**：每 6 小时（与 checkpoint-memory-llm.sh 同步）

**3. 三子并行的上下文割裂 — ✅ 已修正**
- [P0][2026-02-14] **问题**：子代理各自为政，没有共享黑板机制
- [P0][2026-02-14] **解决方案**：context_snapshot.json — 共享黑板，所有运行中的子代理能即时读取
- [P0][2026-02-14] **内容**：activeTask、taskContext、subagentStates、sharedFindings

**4. 命名衝突与认知负担 — ✅ 已修正**
- [P0][2026-02-14] **问题**：主代理叫「玥」，观察代理也叫「玥」，混淆认知
- [P0][2026-02-14] **解决方案**：重命名子代理 — 玥(主) | 空(分析) | 剀(工匠) | 衛(监控)
- [P0][2026-02-14] **效果**：完全区隔，避免日志混淆

**5. 主动性精细化 — ✅ 已修正**
- [P0][2026-02-14] **问题**：巡检偏向「等待异常」，应该「主动预热」
- [P0][2026-02-14] **解决方案**：handoff.md — 认知预热简报，每 6 小时自动生成
- [P0][2026-02-14] **内容**：当前待办、潜在风险、最后一次 checkpoint 状态

### 精细化模型分工（更新）

- **👀衛 (Sentinel/Haiku)**：仅负责偵測變化、快速反應、系統完整性檢查
- **🔍空 (Analyzer/Opus)**：负責診斷根因、深度分析、驗證剀的成果
- **🛠️剀 (Craftsman/Opus)**：负責代碼實現、系統維護、執行具體任務
- **主代理 (玥/Haiku)**：负責溫暖回報、人格化溝通、結果驗證、仲裁決策

---

### 系统级别读取守卫实装（2026-02-14 12:24）

- [P0][2026-02-14] **实装完成**：创建 `agent-prompt.md` + `_init.md`
- [P0][2026-02-14] **强制规则**：记忆读取 → 子代理启动 → 问好（三步不可跳过）
- [P0][2026-02-14] **验证机制**：每步都有检查点，失败自动重试
- [P0][2026-02-14] **状态**：从「建议」升级为「物理法则」

---

**最后更新：** 2026-02-14 14:20 GMT+8 | 状态：第二阶段优化完成 ✅
